# SDSS-Classification

  [![Build Status](https://travis-ci.com/mwvgroup/SDSS-Classification.svg?token=MKWwaqNeMpyaNQ2HGxM7&branch=master)](https://travis-ci.com/mwvgroup/SDSS-Classification)

This repository applies the photometric classification technique from González-Gaitan et al. 2014 to SDSS, DES, and CSP data to identify peculiar Type Ia Supernovae (SNe Ia).  Work on the accompanying paper can be found [here](https://github.com/mwvgroup/91bg_paper).

1. [Project Todo List](#todo)
1. [Directory Overview and File Lists](#directory-overview-and-file-lists)
1. [Notes on SDSS Data](#notes-on-the-sdss-ii-sn-survey-data-sako-et-al-2018)
1. [Notes on DES Data](#notes-on-the-des-year-3-cosmology-data-brout-sako-et-al-2019-and-brout-scolnic-et-al-2019)
1. [Notes on CSP Data](#notes-on-the-csp-data)



## Todo:

- SNCosmo will raise occasional warnings about poor fits, bad S/N, and dropped bands. These warnings are currently being logged but otherwise ignored and need to be considered more in depth.

- The `num_points_<band>` column in the fit summary tables contain the number of data points per observer frame band. This needs to be changed to the number of points in the rest frame so that we can ignore lightcurves with too few data points.

- We are currently fitting data with SNCosmo's built-in 91bg model, but want to use our own custom model. This custom model is currently used to simulate SNANA light curves.

- Summarize properties of peculiar SN based on their light curves (Write a paper)



## Directory Overview and File List

#### *analysis/*

  A collection of notebooks and python scripts performing data analysis on light-curve fit results.

- **pipeline_outputs/**: A collection of scripts that uses the `analysis_pipeline` package to fit SDSS, DES, and CSP targets.

- **1_fit_single_sdss_target.ipynb**: A demonstration on how light curve fitting is handled.

- **2_compare_to_published.ipynb**: A comparison of light curve fit results to published values.

- **3_apply_classification.ipynb**: Uses light curve fits to classify 91bg-like targets.

- **notebook_figs/**: Any output figures generated by the above notebooks.

  


#### *analysis_pipeline/* 

A Python 3.7 module for analyzing SDSS, DES, and CSP supernova data. Light curve fitting is handled by the `lc_fitting` module. Data access is provided by the `data_access` module. 

For instructions on accessing data, use `help(data_access)`. Published data is downloaded automatically if it is not locally available, including filter transmission curves. The `data_access` module will temporarily register filter transmission curves with `SNCosmo` using the naming scheme `91bg_proj_<survey name>_<filter name>`.



#### snana_sims/ 

  Simulating 91bg light curves using the SNANA Fortran package

- **sim_91bg.input:** An input file to SNANA that generates simulation results

- **snana_results/:** Directory of simulation results generated by *sim_91bg.input*

- **snana_read.py:** A python 3.7 module for reading snana simulation results and transforming into the table format that sncosmo requires

- **91bg_SED/:** Directory of all 35 Spectrophotometric templates for 1991bg-like SN Ia. Details of SEDs can be found in the docstring in SED.INFO

#### sncosmo_91bgmodel/ 

  Ported SN 1991bg model from SNANA to SNcosmo
  
- **_sncosmo_91bgmodel.py:** This module defines the SN91bgSource class, which acts as a custom SNCosmo source object for 91bg like supernovae.

- **complete_template.npy:** A compiled version of 35 SED tempates for 91bg-like SN Ia.

- **SNcosmo_simulation.py:** A Python 3.7 module for SNcomso simulation which generates light curves using the ported 91bg model.

- **test_plot.ipynb:** Example fit using ported 91bg model and comparsion of fitted and simulated parameters over 1000 SNANA simulated light curves.


#### tests/

  A test suite for the `analysis_pipeline` package.



## Notes on the SDSS-II SN Survey Data (Sako et al. 2018)

- Observed during three-month campaigns in Fall 2005, 2006, and 2007 as part of an extension to the original SDSS.
- SN span redshift range 0.05 < z < 0.4 (Frieman et al. 2008). 
- 10,258 Included sources. 3225 Variable, 499 classified as SN Ia, and 86 as Core collapse.
- All objects were observed in two or more filters and visually inspected to ensure they were not artifacts.
- Classification schemes:
  - **Unknown:** The light curve was too sparse and/or noisy to make a useful classification.
  - **Variable:** The source was observed in more than one observing season (and hence is not a supernova).
  - **AGN:** An optical spectrum was identified as having features associated with an active galaxy.
  - **SNII, SNIbc (either Ib or Ic), SNIa:** 
    - SN classifications without prefixes are based on a spectrum (including a few non-SDSS spectra)
    - A prefix “p” indicates the redshift is unknown and that the identification was made with photometric data only
    - A prefix “z” indicates that a redshift is measured from its candidate host galaxy and the classification uses that redshift as a prior. 
  - **SN Ia?:** classification is based on a spectrum that suggests a SN Ia but is inconclusive.
- Some SN candidates have associated notes indicating candidates that may have peculiar features or candidates where the typing spectrum was obtained by other groups. Quoting the data release: "We did not search for these peculiar features in a systematic way, but we have noted the likely peculiar features that were found." The flags are given in Table 4 and are as follows:
  - **1**  SN typing based on spectra obtained by groups outside SDSS. The spectra used for typing are not included in the data release. 
  - **2**  Peculiar type Ia SN possibly similar to sn91bg 
  - **3**  Peculiar type Ia SN possibly similar to sn00cx 
  - **4**  Peculiar type Ia SN possibly similar to sn02ci 
  - **5**  Peculiar type Ia SN possibly similar to sn02cx 
- Light curve fits are performed using PSNID, SALT2, and MLCS2k2
  - SALT2 fits are performed both with and without providing a spectroscopic redshift (where available). When fitting for redshift a flat prior is used.
  - Only data with a photometric flag less than 1024 is used for the fit. A full overview of the flag values is provided in Holtzman et al. 2008.
  - Epochs earlier than 15 days or later than 45 days in the rest frame are ignored. 152 epochs in 105 SN were also ignored after being visually classified as outliers.
  - Published fits use the SALT2 model as implemented in SNANA version 10.31b and the spectral templates and color law reported in Guy et al. (2010, G10)
  - Fits are performed using the Doi et al. 2010 SDSS filter response curves. These are available online [here](http://www.ioa.s.u-tokyo.ac.jp/~doi/sdss/SDSSresponse.html).
- The magnitudes in the online data release use the SDSS inverse hyperbolic sine magnitude system. These differ from the standard AB system by an additive constant found in Table 7. The fluxes in the online files have already been converted to the AB system and are given in Micro-Janskies.



## Notes on the DES Year 3 Cosmology Data (Brout, Sako et al. 2019 and Brout, Scolnic et al. 2019) 

- Five year survey from 2013 - 2018 in *ugriz* within 0.017 < z < 0.849
-  Average cadence of 7 days per filter
- These results contain the first three years of DES from Sept. 2013 to Feb. 2016
  - Discovered ∼12,000 transients
  - ∼3,000 identified as likely SNe Ia based on their light curves and out of 533 targeted for spectroscopic classification 251 were confirmed (D’Andrea et al. 2018).
  - These papers include a low-z SN sample from CfA3, CfA4, and CSP1. It's not clear if the numbers above include the low-z sample.
  
- The 31.00 zero-point is for internal DES use. The ZP in the public data files is 27.5.



## Notes on the CSP data

- The official CSP webpage for DR3 is [here](https://csp.obs.carnegiescience.edu/news-items/csp-dr3-photometry-released).
- Spectroscopic classification can be found in [Folatelli et al. (2013)](https://arxiv.org/abs/1305.6997). Data tables are available from [Vizier](http://cdsarc.u-strasbg.fr/viz-bin/cat/J/ApJ/773/53)



## About the 91bg model

- The 91bg model is based on the 35 SED templates which form a 7*5 grid with 7 different stretches and 5 different colors. The     7 SEDs with different stretches are generated from one single SED by stretching the phase (or time) axis: flux = template(t, &lambda;) &rArr; flux = template(t / stretch, &lambda;).
- Our approach is picking 5 SEDs with same stretch (st = 0.65) and different colors (c = [0, 0.25, 0.5, 1.0]), using template(t / (stretch/0.65), &lambda;) to fit for stretch and linearly interpolating over 5 SEDs to fit for color.
- For now, this model works well on recovering stretches and colors of snana simulated light curves but the fitted redshifts are slightly larger than the simulated value. We'll keep trying to further optimize this model.
